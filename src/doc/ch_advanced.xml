<?xml version="1.0"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN" 
  "http://www.docbook.org/xml/5.0/dtd/docbook.dtd">

<chapter xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Advanced Options</title>
  <section id='units'>
    <title>Units</title>
    <para>
      AMEEconnect includes built-in support for a wide range of unit conversions. Most units 
      are SI by default, but if you want to specify fuel in US gallons instead, you can. Time units can also 
      be changed. Each parameter in a profile item has associated Unit and PerUnit parameters which control 
      these. For instance, if you wanted to use the default units for fuel, you could add a fuel purchase with 
      the following parameter, which would represent a fuel usage of 100 litres per month.
    </para>
    <programlisting>volume=100</programlisting>
    <para>
      If, however, you are measuring in gallons on a weekly basis, you could specify the following parameters:
    </para>
    <programlisting>volume=100&amp;volumeUnit=gal&amp;volumePerUnit=week</programlisting>
    <para>
      All unit conversion calculations are automatically handled by AMEEconnect, giving you the correct 
      results for your application with the minimum of effort.
    </para>      
    <section>
      <title>Return Units</title>
      <para>
        Similar to input units, the CO2 emission results generated by AMEE have default units of kg/year. If you 
        prefer pounds per week, you can specify some special parameters in your GET requests:
      </para>
      <programlisting>https://stage.amee.com/profiles/7C7D68C2A7CD/home/energy/quantity?returnUnit=lb&amp;returnPerUnit=week</programlisting>
      <para>
        Note that this only affects the default returned amount contained in the single Amount or TotalAmount tag. 
        The contents of the Amounts tag are not affected, so if you are dealing with multiple gases, this facility
        will not be available. This will be improved in a future version of the API.
      </para>
    </section>
  </section>
  <section>
    <title>Authenticated Sessions</title>
    <para>
      If you do not wish to use HTTP Basic authentication with each request, you can create an
      authenticated session. You will need to make a POST request to 
      https://stage.amee.com/auth, providing your username and password as form-encoded data in the request 
      body. You also need to specify which format you want the result in (XML or JSON) using a standard 
      "Accept" header. The response to this request includes various pieces of information, but the most 
      important is the authentication token, which is returned both as a cookie and as a custom header, 
      both called "authToken". You should store this authToken value and include it as a cookie in any 
      subsequent requests. The authToken will expire after two hours, or if unused for half an 
      hour. Therefore, if you are using authenticated sessions, your application should always be prepared 
      to re-authorise on any request, should the authToken expire.    
    </para>
    <para>
      Note that this facility is deprecated, and will not be present in version 3 of AMEEconnect. We highly recommend
      connecting over HTTPS and using Basic Authentication instead.
    </para>
  </section>
  <section id='paging'>
    <title>Paging</title>
	  <para>
	    Many resources in AMEE are capable of containing a large number of sub-resources, for instance 
	    profile categories can contain many profile items. Retrieving them all in one request may be prohibitively
	    expensive, so for this reason such resources are paged. Details of how to page through items in AMEE are provided in <xref linkend="paging_reference"/>.
	  </para>
  </section>
</chapter>

