<?xml version="1.0"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN" 
  "http://www.docbook.org/xml/5.0/dtd/docbook.dtd"
[
<!ENTITY % translations   SYSTEM "translations.xml">
%translations;
]>

<chapter xmlns:xi="http://www.w3.org/2001/XInclude" xml:id='data'>
  <title>Get Emission Factors</title>
  <para>
    If you just want access to authoritative emission factors, AMEE has you covered. Using &discover; and 
    &api_name;, you can wire the latest data straight into the heart of your application.
  </para>
  <section xml:id='categories'>
    <title>Categories</title>
    <para>
      An AMEE category is a collection of emissions models, representing energy consumption or other activities 
      which share a common way to calculate their associated greenhouse gas emissions. AMEE categories 
      could represent, to give just a few examples, car or train transport, types of fuel, country-specific 
      grid electricity, electrical appliances, and agricultural or industrial processes.
    </para>
	<para>
	  Where similar methodologies exist, perhaps from different sources or representative of different 
	  geographic contexts, alternative categories are available for the same type of emissions activity.
	</para>
    <para>
	  Each category contains a number of different emissions models. These 
	  represent distinct types of the activity represented by the category, such as 
      the use of a particular model of car, or the use of a particular electrical
      appliance. These are sometimes referred to as "data items".
    </para>
  </section>
  <section xml:id='ameediscover'>
    <title>Introduction to &discover;</title>
    <para>
      As a neutral aggregation platform, AMEE contains many different methodologies related to environmental
      intelligence. They use different calculation techniques, different inputs, and have different levels 
      of accuracy. The choice of which of these to use will be up to you, and will be one of the first things 
      you will look at when you come to use the platform. Your choice will depend on your reporting requirements, legal 
      requirements, and so on.
    </para>
    <para>
      Each of these methodologies is a category, and every category within AMEE is individually documented in 
      &discover;. The category page describes how the category works, where it came from, relationships 
      with other categories, and so on. &discover; includes powerful search and tagging capabilities, making 
      it easy to find the categories and models you wish to use. It also lets you perform 
      instant calculations directly in your browser, so you can easily check your results. It can even
      generate example code for you.
    </para>
  </section>
  <section xml:id='using-ameediscover'>
    <title>Using &discover; with &api_name;</title>
    <para>
      If you want to fetch data with &api_name;, you first need to work out which data you want. &discover; helps
      you to do this and gives you the parameters you need to build the required URLs.
    </para>
    <para>
      Firstly, each category in AMEE has a <emphasis>name</emphasis>. This is part of its URL in &api_name;, and
      is shown its API form on the the 'Developer' tab for each category. For instance, the 
	  <ulink url='http://discover.amee.com/categories/DEFRA_transport_fuel_methodology'>DEFRA transport fuel methodology</ulink>
	  category has a name of <emphasis>DEFRA_transport_fuel_methodology</emphasis>.
    </para>
    <para>
      If you want to access a single data item with the category, you will need to identify which one. The &discover; 
	  <ulink url='http://discover.amee.com/categories/DEFRA_transport_fuel_methodology/data'>Data Items</ulink> list is useful here. It shows
      all the emissions models (or data items) within a category, including their drilldown options.
    </para>
  </section>
  <section xml:id='drilldowns'>
    <title>Performing Drilldowns</title>
    <para>
      Emissions models are identified by their UIDs, not by textual names. In order to get one of these UIDs, you need to perform a drilldown
      request. To find the UID for the petrol model in the DEFRA transport fuel methodology, you need to make the following call:
    </para>
	<xi:include href='samples/get_3_categories_DEFRA_transport_fuel_methodology_drill_fuel=petrol.xml' />
    <para>
      A drilldown response consists of two sections. The first is the list of 'Selections'. This shows drill selections that have already been
      made and specified in the drilldown URL. The second are the 'Choices', which shows what choices are available for the next 
      drill selection. Repeated drilldown requests allow you to interactively choose the model you want to use from a potentially very large list;
	  see <xref linkend='interactive-drilldowns'/> for details.
    </para>
    <para>
      Here, however, we know all the drill choices we want in advance, so we can specify all the required
      options and get the resulting UID directly. You can see in the response above that the next choice is called 'uid', and there is only one
	  option. This is the UID for the item we are interested in, in this case 19B311DDF0B1.
    </para>
    <para>
      <strong>NOTE:</strong> These UIDs are not necessarily the same across different platforms. You should <strong>not</strong> hardcode them
	  into your application, as it will certainly break when you move from the AMEE staging platform to live. Instead, you should always do a 
	  drilldown request. It's safe to cache the UIDs once they've been fetched, however, as they change extremely rarely on a single platform.
    </para>
  </section>
  <section xml:id='get-data-items'>
    <title>Fetching Data Items</title>
    <para>
      If you want to get the raw emission factors for a model, you can, once you have the UID. You will also need the UID for
      calculations (see next chapter).
    </para>
    <para>
      Fetching a data item is a simple GET to the category items list, with the UID as the last element. You should include the 'values' matrix
	  parameter to get back the list of values contained within the item.
    </para>
	<xi:include href='samples/get_3_categories_DEFRA_transport_fuel_methodology_items_UID;values.xml' />
    <para>
      If you look at the response above, you can see that there are a series of values. Each of these represents a single factor
      or input. If you want to know how much co2 is emitted per litre of petrol, the massTotalCO2ePerVolume value would be the most useful.
      This shows that the factor is 2.7227 kg/L. Alternatively, massCH4PerVolume shows that 0.0034 kg of methane is produced for every litre
      of fuel. However, these input values do vary between categories so you can't assume that the names are always the same.
    </para>
  </section>
  <para>
    These factors can be useful, but it's more often useful to get AMEE to do the entire calculation for you. Many algorithms are much
    more complex than a*b, and you don't want to implement them all yourself. We'll look at calculations in the next section.
  </para>
</chapter>